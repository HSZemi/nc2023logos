<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>NC2023 Logo Generator</title>
    <link rel="stylesheet" href="css/coloris.min.css"/>
    <style>
        html {
            font-family: "Roboto", sans-serif;
        }

        #preview {
            max-width: 600px;
        }

        .hidden {
            display: none;
        }

        button.btn {
            cursor: pointer;
            padding: 1em 2em;
            background: linear-gradient(to right, #00ffff, #d61eff);
            font-size: 110%;
            border: 0;
            font-weight: bold;
            color: #111;
            transition: color .2s, background .2s;
        }
        button.btn:hover {
            color: #eee;
            background: linear-gradient(to bottom, #d61eff,  #00ffff);
        }
        footer {
            padding-top: .5rem;
            margin-top: 1rem;
            border-top: 2px solid #ccc;
            color: #333;
        }
    </style>
</head>
<body>
<h1>NC2023 Logo Generator</h1>
<div id="preview">
</div>
<a id="logo-dl">Download svg</a>
<div id="controls">
    <h2>Pick colours</h2>
    <button class="btn" onclick="useHorizontalFlags()">Use horizontal flags</button>
    <button class="btn" onclick="useVerticalFlags()">Use vertical flags</button>

    <div id="horizontal-flags">
        <h3>Flags (horizontal)</h3>
        <table>
            <tbody>
            <tr>
                <td><input id="pick-left-top" type="text" value="#c1272d" data-coloris></td>
                <td><input id="link-top" type="checkbox" checked><label for="link-top">link</label></td>
                <td><input id="pick-right-top" type="text" value="#c1272d" data-coloris></td>
            </tr>
            <tr>
                <td><input id="pick-left-centre" type="text" value="#f2e144" data-coloris></td>
                <td><input id="link-centre" type="checkbox" checked><label for="link-centre">link</label></td>
                <td><input id="pick-right-centre" type="text" value="#f2e144" data-coloris></td>
            </tr>
            <tr>
                <td><input id="pick-left-bottom" type="text" value="#c1272d" data-coloris></td>
                <td><input id="link-bottom" type="checkbox" checked><label for="link-bottom">link</label></td>
                <td><input id="pick-right-bottom" type="text" value="#c1272d" data-coloris></td>
            </tr>
            </tbody>
        </table>
    </div>

    <div id="vertical-flags" class="hidden">
        <h3>Flags (vertical)</h3>
        <table>
            <tbody>
            <tr>
                <td><input id="pick-v-left-left-top" type="text" value="#c1272d" data-coloris></td>
                <td><input id="pick-v-left-middle-top" type="text" value="#ffffff" data-coloris></td>
                <td><input id="pick-v-left-right-top" type="text" value="#009246" data-coloris></td>
                <td><input id="link-v-top" type="checkbox" checked><label for="link-v-top">link</label></td>
                <td><input id="pick-v-right-left-top" type="text" value="#009246" data-coloris></td>
                <td><input id="pick-v-right-middle-top" type="text" value="#ffffff" data-coloris></td>
                <td><input id="pick-v-right-right-top" type="text" value="#c1272d" data-coloris></td>
            </tr>
            <tr>
                <td><input id="pick-v-left-left-middle" type="text" value="#c1272d" data-coloris></td>
                <td><input id="pick-v-left-middle-middle" type="text" value="#ffffff" data-coloris></td>
                <td><input id="pick-v-left-right-middle" type="text" value="#009246" data-coloris></td>
                <td><input id="link-v-middle" type="checkbox" checked><label for="link-v-middle">link</label></td>
                <td><input id="pick-v-right-left-middle" type="text" value="#009246" data-coloris></td>
                <td><input id="pick-v-right-middle-middle" type="text" value="#ffffff" data-coloris></td>
                <td><input id="pick-v-right-right-middle" type="text" value="#c1272d" data-coloris></td>
            </tr>
            <tr>
                <td><input id="pick-v-left-left-bottom" type="text" value="#c1272d" data-coloris></td>
                <td><input id="pick-v-left-middle-bottom" type="text" value="#ffffff" data-coloris></td>
                <td><input id="pick-v-left-right-bottom" type="text" value="#009246" data-coloris></td>
                <td><input id="link-v-bottom" type="checkbox" checked><label for="link-v-bottom">link</label></td>
                <td><input id="pick-v-right-left-bottom" type="text" value="#009246" data-coloris></td>
                <td><input id="pick-v-right-middle-bottom" type="text" value="#ffffff" data-coloris></td>
                <td><input id="pick-v-right-right-bottom" type="text" value="#c1272d" data-coloris></td>
            </tr>
            <tr>
                <td><input id="link-v-left-left" type="checkbox" checked><label for="link-v-left-left">link</label></td>
                <td><input id="link-v-left-middle" type="checkbox" checked><label for="link-v-left-middle">link</label>
                </td>
                <td><input id="link-v-left-right" type="checkbox" checked><label for="link-v-left-right">link</label>
                </td>
                <td></td>
                <td><input id="link-v-right-left" type="checkbox" checked><label for="link-v-right-left">link</label>
                </td>
                <td><input id="link-v-right-middle" type="checkbox" checked><label
                        for="link-v-right-middle">link</label>
                </td>
                <td><input id="link-v-right-right" type="checkbox" checked><label for="link-v-right-right">link</label>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <h3>Cape</h3>
    <table>
        <tbody>
        <tr>
            <td><input id="pick-cape-dark" type="text" value="#a32151" data-coloris>
                <label for="pick-cape-dark">Cape (dark)</label></td>
        </tr>
        <tr>
            <td><input id="pick-cape-highlight" type="text" value="#c42b64" data-coloris>
                <label for="pick-cape-highlight">Cape (highlight)</label></td>
        </tr>
        </tbody>
    </table>
    <h3>Border</h3>
    <table>
        <tbody>
        <tr>
            <td><input id="pick-border" type="text" value="#edca61" data-coloris>
                <label for="pick-border">Border</label></td>
        </tr>
        </tbody>
    </table>

</div>
<footer><a href="https://github.com/hszemi/nc2023logos">improve me, daddy</a></footer>
<script src="js/coloris.min.js"></script>
<script>
    // https://stackoverflow.com/questions/5560248/programmatically-lighten-or-darken-a-hex-color-or-rgb-and-blend-colors
    const pSBC = (p, c0, c1, l) => {
        let r, g, b, P, f, t, h, i = parseInt, m = Math.round, a = typeof (c1) == "string";
        if (typeof (p) != "number" || p < -1 || p > 1 || typeof (c0) != "string" || (c0[0] != 'r' && c0[0] != '#') || (c1 && !a)) return null;
        if (!this.pSBCr) this.pSBCr = (d) => {
            let n = d.length, x = {};
            if (n > 9) {
                [r, g, b, a] = d = d.split(","), n = d.length;
                if (n < 3 || n > 4) return null;
                x.r = i(r[3] == "a" ? r.slice(5) : r.slice(4)), x.g = i(g), x.b = i(b), x.a = a ? parseFloat(a) : -1
            } else {
                if (n == 8 || n == 6 || n < 4) return null;
                if (n < 6) d = "#" + d[1] + d[1] + d[2] + d[2] + d[3] + d[3] + (n > 4 ? d[4] + d[4] : "");
                d = i(d.slice(1), 16);
                if (n == 9 || n == 5) x.r = d >> 24 & 255, x.g = d >> 16 & 255, x.b = d >> 8 & 255, x.a = m((d & 255) / 0.255) / 1000;
                else x.r = d >> 16, x.g = d >> 8 & 255, x.b = d & 255, x.a = -1
            }
            return x
        };
        h = c0.length > 9, h = a ? c1.length > 9 ? true : c1 == "c" ? !h : false : h, f = this.pSBCr(c0), P = p < 0, t = c1 && c1 != "c" ? this.pSBCr(c1) : P ? {
            r: 0,
            g: 0,
            b: 0,
            a: -1
        } : {r: 255, g: 255, b: 255, a: -1}, p = P ? p * -1 : p, P = 1 - p;
        if (!f || !t) return null;
        if (l) r = m(P * f.r + p * t.r), g = m(P * f.g + p * t.g), b = m(P * f.b + p * t.b);
        else r = m((P * f.r ** 2 + p * t.r ** 2) ** 0.5), g = m((P * f.g ** 2 + p * t.g ** 2) ** 0.5), b = m((P * f.b ** 2 + p * t.b ** 2) ** 0.5);
        a = f.a, t = t.a, f = a >= 0 || t >= 0, a = f ? a < 0 ? t : t < 0 ? a : a * P + t * p : 0;
        if (h) return "rgb" + (f ? "a(" : "(") + r + "," + g + "," + b + (f ? "," + m(a * 1000) / 1000 : "") + ")";
        else return "#" + (4294967296 + r * 16777216 + g * 65536 + b * 256 + (f ? m(a * 255) : 0)).toString(16).slice(1, f ? undefined : -2)
    }

    const setdownload = () => {
        const text = document.querySelector('#preview').innerHTML;
        const name = 'nc2023logo.svg';
        const a = document.getElementById('logo-dl');
        const file = new Blob([text], {type: 'text/svg'});
        a.href = URL.createObjectURL(file);
        a.download = name;
    }

    const updateColour = (side, position, newValue) => {
        const svgClass = `${side}-${position}`;
        const lighterValue = pSBC(0.1, newValue);
        let style = document.querySelector("#preview > svg > defs > style");
        style.innerHTML = style.innerHTML.replace(RegExp(`\\.${svgClass}\\{.+\\}`), `.${svgClass}{fill:${newValue};}`);
        style.innerHTML = style.innerHTML.replace(RegExp(`\\.${svgClass}-border\\{.+\\}`), `.${svgClass}-border{fill:${lighterValue};}`);
    }

    const updateYColour = (side, xPosition, yPosition, newValue) => {
        const svgClass = `${side}-${xPosition}-${yPosition}`;
        let style = document.querySelector("#preview > svg > defs > style");
        style.innerHTML = style.innerHTML.replace(RegExp(`\\.${svgClass}\\{.+\\}`), `.${svgClass}{fill:${newValue};}`);
    }

    const updatePicker = (side, position, newValue) => {
        let element = document.getElementById(`pick-${side}-${position}`);
        element.value = newValue;
        element.dispatchEvent(new Event('input', {bubbles: true}));
    }

    const updateYPicker = (side, xPosition, yPosition, newValue) => {
        let element = document.getElementById(`pick-v-${side}-${xPosition}-${yPosition}`);
        element.value = newValue;
        element.dispatchEvent(new Event('input', {bubbles: true}));
    }

    const useHorizontalFlags = () => {
        for (let element of document.querySelectorAll('input')) {
            element.dispatchEvent(new Event('change', {bubbles: true}));
        }
        document.getElementById('vertical-flags').classList.add('hidden');
        document.getElementById('horizontal-flags').classList.remove('hidden');
        for (let side of ['left', 'right']) {
            for (let xPosition of ['left', 'middle', 'right']) {
                for (let yPosition of ['top', 'middle', 'bottom']) {
                    updateYColour(side, xPosition, yPosition, 'none');
                }
            }
        }
        document.getElementById('pick-left-bottom').dispatchEvent(new Event('change', {bubbles: true}));
        document.getElementById('pick-right-bottom').dispatchEvent(new Event('change', {bubbles: true}));
        setdownload();
    }
    const useVerticalFlags = () => {
        for (let element of document.querySelectorAll('input')) {
            element.dispatchEvent(new Event('change', {bubbles: true}));
        }
        document.getElementById('vertical-flags').classList.remove('hidden');
        document.getElementById('horizontal-flags').classList.add('hidden');
        for (let side of ['left', 'right']) {
            for (let position of ['top', 'centre', 'bottom']) {
                updateColour(side, position, 'none');
            }
        }
        document.getElementById('pick-v-left-middle-bottom').dispatchEvent(new Event('change', {bubbles: true}));
        document.getElementById('pick-v-right-middle-bottom').dispatchEvent(new Event('change', {bubbles: true}));
        setdownload();
    }

    for (let side of ['left', 'right']) {
        for (let position of ['top', 'centre', 'bottom']) {
            let pickerId = `pick-${side}-${position}`;
            document.getElementById(pickerId).addEventListener('change', (event) => {
                let newValue = document.getElementById(pickerId).value;
                updateColour(side, position, newValue);
                if (document.getElementById(`link-${position}`).checked) {
                    const otherSide = side === 'left' ? 'right' : 'left';
                    updateColour(otherSide, position, newValue);
                    updatePicker(otherSide, position, newValue);
                }
                setdownload();
            })
        }
    }
    for (let side of ['left', 'right']) {
        for (let xPosition of ['left', 'middle', 'right']) {
            for (let yPosition of ['top', 'middle', 'bottom']) {
                let pickerId = `pick-v-${side}-${xPosition}-${yPosition}`;
                document.getElementById(pickerId).addEventListener('change', (event) => {
                    let newValue = document.getElementById(pickerId).value;
                    updateYColour(side, xPosition, yPosition, newValue);
                    if (document.getElementById(`link-v-${side}-${xPosition}`).checked) {
                        updateYColour(side, xPosition, 'top', newValue);
                        updateYPicker(side, xPosition, 'top', newValue);
                        updateYColour(side, xPosition, 'middle', newValue);
                        updateYPicker(side, xPosition, 'middle', newValue);
                        updateYColour(side, xPosition, 'bottom', newValue);
                        updateYPicker(side, xPosition, 'bottom', newValue);
                    }
                    if (document.getElementById(`link-v-${yPosition}`).checked) {
                        const oppositeSide = side === 'left' ? 'right' : 'left';
                        const oppositeRow = xPosition === 'middle' ? 'middle' : xPosition === 'left' ? 'right' : 'left';
                        updateYColour(oppositeSide, oppositeRow, yPosition, newValue);
                        updateYPicker(oppositeSide, oppositeRow, yPosition, newValue);
                        if (document.getElementById(`link-v-${oppositeSide}-${oppositeRow}`).checked) {
                            updateYColour(oppositeSide, oppositeRow, 'top', newValue);
                            updateYPicker(oppositeSide, oppositeRow, 'top', newValue);
                            updateYColour(oppositeSide, oppositeRow, 'middle', newValue);
                            updateYPicker(oppositeSide, oppositeRow, 'middle', newValue);
                            updateYColour(oppositeSide, oppositeRow, 'bottom', newValue);
                            updateYPicker(oppositeSide, oppositeRow, 'bottom', newValue);
                        }
                    }
                    setdownload();
                })
            }
        }
    }
    for (let position of ['dark', 'highlight']) {
        const pickerId = `pick-cape-${position}`;
        document.getElementById(pickerId).addEventListener('change', (event) => {
            let newValue = document.getElementById(pickerId).value;
            updateColour('cape', position, newValue);
        });
    }
    document.getElementById('pick-border').addEventListener('change', (event) => {
        let newValue = document.getElementById('pick-border').value;
        updateColour('border', 'outline', newValue);
    });

    fetch('svg/Recurso_19.svg')
        .then(response => response.text())
        .then(svg => {
            document.getElementById('preview').innerHTML = svg;
            useHorizontalFlags();
        });


</script>
</body>
</html>