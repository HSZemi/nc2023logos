<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>NC2023 Logo Generator</title>
    <link rel="stylesheet" href="css/coloris.min.css"/>
    <style>
        html {
            font-family: "Roboto", sans-serif;
        }
        #preview {
            max-width: 600px;
        }
    </style>
</head>
<body>
<h1>NC2023 Logo Generator</h1>
<div id="preview">
    <object id="svgitem" type="image/svg+xml" data="svg/Recurso_19.svg"></object>
</div>
<div id="controls">
    <h2>Pick colours</h2>
    <h3>Flags</h3>
    <table>
        <tbody>
        <tr>
            <td><input id="pick-left-top" type="text" value="#c1272d" data-coloris></td>
            <td><input id="link-top" type="checkbox" checked><label for="link-top">link</label></td>
            <td><input id="pick-right-top" type="text" value="#c1272d" data-coloris></td>
        </tr>
        <tr>
            <td><input id="pick-left-centre" type="text" value="#f2e144" data-coloris></td>
            <td><input id="link-centre" type="checkbox" checked><label for="link-centre">link</label></td>
            <td><input id="pick-right-centre" type="text" value="#f2e144" data-coloris></td>
        </tr>
        <tr>
            <td><input id="pick-left-bottom" type="text" value="#c1272d" data-coloris></td>
            <td><input id="link-bottom" type="checkbox" checked><label for="link-bottom">link</label></td>
            <td><input id="pick-right-bottom" type="text" value="#c1272d" data-coloris></td>
        </tr>
        </tbody>
    </table>
    <h3>Cape</h3>
    <table>
        <tbody>
        <tr>
            <td><input id="pick-cape-dark" type="text" value="#a32151" data-coloris>
                <label for="pick-cape-dark">Cape (dark)</label></td>
        </tr>
        <tr>
            <td><input id="pick-cape-highlight" type="text" value="#c42b64" data-coloris>
                <label for="pick-cape-highlight">Cape (highlight)</label></td>
        </tr>
        </tbody>
    </table>

</div>
<script src="js/coloris.min.js"></script>
<script>
    // https://stackoverflow.com/questions/5560248/programmatically-lighten-or-darken-a-hex-color-or-rgb-and-blend-colors
    const pSBC = (p, c0, c1, l) => {
        let r, g, b, P, f, t, h, i = parseInt, m = Math.round, a = typeof (c1) == "string";
        if (typeof (p) != "number" || p < -1 || p > 1 || typeof (c0) != "string" || (c0[0] != 'r' && c0[0] != '#') || (c1 && !a)) return null;
        if (!this.pSBCr) this.pSBCr = (d) => {
            let n = d.length, x = {};
            if (n > 9) {
                [r, g, b, a] = d = d.split(","), n = d.length;
                if (n < 3 || n > 4) return null;
                x.r = i(r[3] == "a" ? r.slice(5) : r.slice(4)), x.g = i(g), x.b = i(b), x.a = a ? parseFloat(a) : -1
            } else {
                if (n == 8 || n == 6 || n < 4) return null;
                if (n < 6) d = "#" + d[1] + d[1] + d[2] + d[2] + d[3] + d[3] + (n > 4 ? d[4] + d[4] : "");
                d = i(d.slice(1), 16);
                if (n == 9 || n == 5) x.r = d >> 24 & 255, x.g = d >> 16 & 255, x.b = d >> 8 & 255, x.a = m((d & 255) / 0.255) / 1000;
                else x.r = d >> 16, x.g = d >> 8 & 255, x.b = d & 255, x.a = -1
            }
            return x
        };
        h = c0.length > 9, h = a ? c1.length > 9 ? true : c1 == "c" ? !h : false : h, f = this.pSBCr(c0), P = p < 0, t = c1 && c1 != "c" ? this.pSBCr(c1) : P ? {
            r: 0,
            g: 0,
            b: 0,
            a: -1
        } : {r: 255, g: 255, b: 255, a: -1}, p = P ? p * -1 : p, P = 1 - p;
        if (!f || !t) return null;
        if (l) r = m(P * f.r + p * t.r), g = m(P * f.g + p * t.g), b = m(P * f.b + p * t.b);
        else r = m((P * f.r ** 2 + p * t.r ** 2) ** 0.5), g = m((P * f.g ** 2 + p * t.g ** 2) ** 0.5), b = m((P * f.b ** 2 + p * t.b ** 2) ** 0.5);
        a = f.a, t = t.a, f = a >= 0 || t >= 0, a = f ? a < 0 ? t : t < 0 ? a : a * P + t * p : 0;
        if (h) return "rgb" + (f ? "a(" : "(") + r + "," + g + "," + b + (f ? "," + m(a * 1000) / 1000 : "") + ")";
        else return "#" + (4294967296 + r * 16777216 + g * 65536 + b * 256 + (f ? m(a * 255) : 0)).toString(16).slice(1, f ? undefined : -2)
    }
    const updateColour = (side, position, newValue) => {
        const svgClass = `${side}-${position}`;
        const lighterValue = pSBC(0.1, newValue);
        let cssRules = document.getElementById('svgitem').contentDocument.styleSheets[0].cssRules;
        for (let i = 0; i < cssRules.length; i++) {
            if (cssRules[i].selectorText === `.${svgClass}`) {
                cssRules[i].style.fill = newValue;
            }
            if (cssRules[i].selectorText === `.${svgClass}-border`) {
                cssRules[i].style.fill = lighterValue;
            }
        }
    }

    const updatePicker = (side, position, newValue) => {
        let element = document.getElementById(`pick-${side}-${position}`);
        element.value = newValue;
        element.dispatchEvent(new Event('input', {bubbles: true}));
    }

    for (let side of ['left', 'right']) {
        for (let position of ['top', 'centre', 'bottom']) {
            let pickerId = `pick-${side}-${position}`;
            document.getElementById(pickerId).addEventListener('change', (event) => {
                let newValue = document.getElementById(pickerId).value;
                updateColour(side, position, newValue);
                if (document.getElementById(`link-${position}`).checked) {
                    const otherSide = side === 'left' ? 'right' : 'left';
                    updateColour(otherSide, position, newValue);
                    updatePicker(otherSide, position, newValue);
                }
            })
        }
    }
    for (let position of ['dark', 'highlight']) {
        const pickerId = `pick-cape-${position}`;
        document.getElementById(pickerId).addEventListener('change', (event) => {
            let newValue = document.getElementById(pickerId).value;
            updateColour('cape', position, newValue);
        });
    }

    setTimeout(() => {
        for (let element of document.querySelectorAll('input')) {
            console.log(element);
            element.dispatchEvent(new Event('change', {bubbles: true}));
        }
    }, 500);


</script>
</body>
</html>